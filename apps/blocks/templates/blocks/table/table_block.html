{% load static %}
<link href="https://unpkg.com/tabulator-tables@6.2.1/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://unpkg.com/tabulator-tables@6.2.1/dist/js/tabulator.min.js"></script>

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <label class="me-2">View:</label>
    <select id="column-config-select" class="form-select d-inline-block w-auto me-2">
      {% for cfg in column_configs %}
        <option value="{{ cfg.id }}" {% if cfg.id == active_column_config_id %}selected{% endif %}>
          {{ cfg.name }}
        </option>
      {% endfor %}
    </select>
    <a class="btn btn-link p-0" href="{% url 'column_config_view' block_name %}">Manage Views</a>
  </div>


</div>

<div id="table-{{ block_name }}"></div>

{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    // 1) Initialize the table
    const table = new Tabulator("#table-{{ block_name }}", {
      layout: "fitColumns",
      data:{{ data|safe }},
      columns:{{ columns|safe }},
      ...{{ tabulator_options|safe }},  // ensure trailing comma
    });

    document.getElementById("column-config-select")?.addEventListener("change", function() {
      location.href = `?column_config_id=${this.value}`;
    });

    document.getElementById("filter-config-select")?.addEventListener("change", function() {
      location.href = `?filter_config_id=${this.value}`;
    });
  });
</script>
{% endblock %}

