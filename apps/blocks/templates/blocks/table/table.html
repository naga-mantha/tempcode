{% extends "base.html" %}
{% load dict_extras static %}

{% block title %}<title>{{ title }}</title>{% endblock %}

{% block content %}
<div class="container py-3">
  {% include 'blocks/table/table_card.html' %}
</div>
{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script src="{% static 'common/js/table-filters.js' %}"></script>
  <script>
    (function initTableCards() {
      var legacyKey = 'v' + '2' + 'TableFilters';
      var filters = window.tableFilters || window[legacyKey];
      if (!window.tableFilters && filters) {
        window.tableFilters = filters;
      }
      if (!filters) {
        return;
      }
      function bootstrap(scope) {
        if (!scope || !scope.querySelectorAll) {
          return;
        }
        var activeFilters = window.tableFilters || window[legacyKey];
        if (!activeFilters) {
          return;
        }
        var nodes = scope.querySelectorAll('script[type="application/json"][id^="table-config-"]');
        nodes.forEach(function (node) {
          if (node.dataset && node.dataset.initialized === '1') {
            return;
          }
          try {
            var cfg = JSON.parse(node.textContent || '{}');
            if (cfg && cfg.domId) {
              activeFilters.init(cfg);
              if (node.dataset) {
                node.dataset.initialized = '1';
              }
            }
          } catch (err) {
            console.warn('Failed to init table config', err);
          }
        });
      }
      bootstrap(document);
      document.addEventListener('htmx:afterSwap', function (event) {
        var activeFilters = window.tableFilters || window[legacyKey];
        if (!activeFilters) {
          return;
        }
        var scope = event && event.target ? event.target : document;
        bootstrap(scope);
      });
    })();
  </script>
{% endblock %}
