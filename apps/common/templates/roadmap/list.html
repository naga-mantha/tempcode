{% extends 'base.html' %}
{% load static %}

{% block title %}<title>{{ title }}</title>{% endblock %}

{% block content %}
<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="h4 m-0">{{ title }}</h2>
    <form class="d-flex gap-2" method="get">
      <div class="input-group input-group-sm" style="width: 180px;">
        <label class="input-group-text" for="sort">Sort</label>
        <select class="form-select" name="sort" id="sort" onchange="this.form.submit()">
          <option value="timeframe" {% if sort == 'timeframe' %}selected{% endif %}>By Timeframe</option>
          <option value="app" {% if sort == 'app' %}selected{% endif %}>By App</option>
        </select>
      </div>
      <div class="input-group input-group-sm" style="width: 200px;">
        <label class="input-group-text" for="status">Status</label>
        <select class="form-select" name="status" id="status" onchange="this.form.submit()">
          {% for val,label in status_choices %}
            <option value="{{ val }}" {% if status == val %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
      {# No hidden sort field; both selects submit together #}
    </form>
  </div>

  {% for group in groups %}
    <div class="mb-4">
      <div class="d-flex align-items-center mb-2">
        <h3 class="h6 m-0">{{ group.name }}</h3>
        <span class="badge bg-secondary ms-2">{{ group.items|length }}</span>
      </div>
      <div class="accordion" id="accordion-{{ forloop.counter }}">
        {% for item in group.items %}
          <div class="accordion-item">
            <h2 class="accordion-header" id="heading-{{ forloop.parentloop.counter }}-{{ forloop.counter }}">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ forloop.parentloop.counter }}-{{ forloop.counter }}" aria-expanded="false" aria-controls="collapse-{{ forloop.parentloop.counter }}-{{ forloop.counter }}">
                <div class="d-flex flex-column flex-sm-row w-100">
                  <span class="fw-semibold me-2">{{ item.title }}</span>
                  <span class="ms-auto d-flex gap-2 small">
                    <span class="badge text-bg-light border">{{ item.app }}</span>
                    <span class="badge text-bg-light border">{{ item.timeframe }}</span>
                    <span class="badge {% if item.status == 'completed' %}bg-success{% elif item.status == 'in_progress' %}bg-warning text-dark{% else %}bg-secondary{% endif %}">{{ item.get_status_display }}</span>
                  </span>
                </div>
              </button>
            </h2>
            <div id="collapse-{{ forloop.parentloop.counter }}-{{ forloop.counter }}" class="accordion-collapse collapse" aria-labelledby="heading-{{ forloop.parentloop.counter }}-{{ forloop.counter }}" data-bs-parent="#accordion-{{ forloop.parentloop.counter }}">
              <div class="accordion-body">
                {% if item.description %}
                  <div class="mb-2">
                    <div class="fw-semibold">Description</div>
                    <div class="text-muted">{{ item.description|linebreaksbr }}</div>
                  </div>
                {% endif %}
                {% if item.technical_specifications %}
                  <div>
                    <div class="fw-semibold">Technical Specifications</div>
                    <div class="text-muted">{{ item.technical_specifications|linebreaksbr }}</div>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        {% empty %}
          <div class="text-muted small">No items.</div>
        {% endfor %}
      </div>
    </div>
  {% endfor %}
</div>
{% endblock %}
