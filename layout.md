  Overview                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                              
  - Pure composition layer: arranges blocks, delegates data to blocks, persists per-instance settings.                                                                                                                                        
  - HTMX-driven partials; Bootstrap 5.3 components; theme-aware.                                                                                                                                                                              
                                                                                                                                                                                                                                              
  Composition & Grid                                                                                                                                                                                                                          
                                                                                                                                                                                                                                              
  - Drag-and-drop grid (keep x/y/w/h via Gridstack semantics).                                                                                                                                                                                
  - Per-block instance props: title, note, position, preferred sizes.                                                                                                                                                                         
  - Add/remove/reorder blocks; lazy-load block content with skeletons.                                                                                                                                                                        

  Filter UX (Shared)                                                                                                                                                                                                                          
                                                                                                                                                                                                                                              
  - Header: Edit Layout, Layout Filter dropdown, Manage, Reset.                                                                                                                                                                               
  - Sidebar offcanvas for “Filter Conditions” driven by layout filter schema.                                                                                                                                                                 
  - Saved filter configs: private/public; pick active; badges for active filters.                                                                                                                                                             
                                                                                                                                                                                                                                              
  Persistence & Visibility                                                                                                                                                                                                                    
                                                                                                                                                                                                                                              
  - Private and Public layouts; categories; list in sidebar (alphabetical, highlight current).                                                                                                                                                
  - Layout CRUD: list, create, edit, detail, delete.                                                                                                                                                                                          
  - Persist offcanvas open/closed state; persist layout defaults.                                                                                                                                                                             
                                                                                                                                                                                                                                              
  Block Interactions                                                                                                                                                                                                                          
                                                                                                                                                                                                                                              
  - Standard block chrome (title, note, actions).                                                                                                                                                                                             
  - Block refresh via HTMX; pagination/sort/filters/exports from the block.                                                                                                                                                                   
  - Save per-block settings (minor tweaks) via POST /layouts/<username>/<slug>/blocks/<id>/settings.                                                                                                                                          
                                                                                                                                                                                                                                              
  Content Blocks
                                                                                                                                                                                                                                              
  - Spacer, Text, Button, Card with JSON settings saved on LayoutBlock.settings.                                                                                                                                                              
  - Render content blocks directly (no data services).                                                                                                                                                                                        
                                                                                                                                                                                                                                              
  Context-Aware Detail Pages                                                                                                                                                                                                                  
                                                                                                                                                                                                                                              
  - Model/object-scoped “detail layouts” mapped via scope_type/scope_ref.                                                                                                                                                                     
  - Context object passed to blocks (model, id, extra).                                                                                                                                                                                       
  - Bindings in LayoutBlock.settings map context → block filters/config.                                                                                                                                                                      
  - Server validates access and re-fetches object each request.                                                                                                                                                                               
                                                                                                                                                                                                                                              
  Endpoints                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                              
  - Blocks partials: GET /blocks/<block_code>/partial (used inside layouts).                                                                                                                                                                  
  - Block config saves (columns/filters) re-used from blocks.                                                                                                                                                                                 
  - Layout block settings: POST /layouts/<username>/<slug>/blocks/<id>/settings.                                                                                                                                                              
                                                                                                                                                                                                                                              
  Data Model                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                              
  - LayoutBlock gains settings: JSONField(default=dict) for per-instance settings/bindings.                                                                                                                                                   
  - Keep x/y/w/h, position, title, note, preferred_* fields (v1 parity).                                                                                                                                                                      
                                                                                                                                                                                                                                              
  Theming & UX                                                                                                                                                                                                                                
                                                                                                                                                                                                                                              
  - Bootstrap 5.3 light/dark via data-bs-theme (persist in localStorage + cookie).                                                                                                                                                            
  - Consistent controls, compact spacing; accessible labels and keyboard support.                                                                                                                                                             
                                                                                                                                                                                                                                              
  Error & Empty States                                                                                                                                                                                                                        
                                                                                                                                                                                                                                              
  - Standardized alert cards for block errors and empty datasets.                                                                                                                                                                             
  - Inline notices on HTMX errors; retry affordances.                                                                                                                                                                                         
                                                                                                                                                                                                                                              
  Performance                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                              
  - Lazy-loading of blocks; prefer server-side pagination for heavy tables.                                                                                                                                                                   
  - Cache small choice lists; measure per-block render times.                                                                                                                                                                                 
                                                                                                                                                                                                                                              
  v1 Parity Checklist                                                                                                                                                                                                                         
                                                                                                                                                                                                                                              
  - Layout list/create/edit/detail/delete screens.                                                                                                                                                                                            
  - Drag grid with persisted x/y/w/h; add/remove blocks.                                                                                                                                                                                      
  - Per-block title/note; preferred sizes; categories; private/public.                                                                                                                                                                        
  - Layout-level filter config screen; shared filter rendering using components/filter_fields.html.                                                                                                                                           
  - Manage and pick saved filters; defaults honored.                                                     